# ï¿½ï¿½ æ™‚å€å•é¡Œæœ€çµ‚ç¢ºèªèˆ‡ä¿®æ­£

## ğŸ” å•é¡Œç¢ºèª

### API å¯¦éš›å›å‚³çš„è³‡æ–™
```json
{
  "eventTime": "2025-10-28T08:09:14",
  "targetUserName": "Poper Lin"
}
```

### å¯¦éš›æ¶ˆè²»æ™‚é–“
- **é¡¯ç¤ºæ‡‰è©²æ˜¯**: 2025-10-28 16:09:14 (æ‚¨çš„æœ¬åœ°æ™‚é–“ UTC+8)
- **API å›å‚³çš„**: 2025-10-28 08:09:14 (UTC æ™‚é–“)
- **æ™‚å·®**: æ­£å¥½ 8 å°æ™‚

### çµè«–
âœ… API å›å‚³çš„ `eventTime` **ç¢ºå¯¦æ˜¯ UTC æ™‚é–“**
âœ… éœ€è¦è½‰æ›ç‚ºæœ¬åœ°æ™‚é–“ï¼ˆUTC+8ï¼‰

## âœ… æ­£ç¢ºçš„è§£æ±ºæ–¹æ¡ˆ

### æ™‚é–“è½‰æ›é‚è¼¯

```dart
factory ConsumptionRecord.fromJson(Map<String, dynamic> json) {
  final timeString = json['eventTime'] as String;
  DateTime timestamp;
  
  if (timeString.endsWith('Z')) {
    // å¦‚æœæœ‰ 'Z' æ¨™è¨˜ï¼Œè¡¨ç¤ºæ˜ç¢ºçš„ UTC æ™‚é–“
    timestamp = DateTime.parse(timeString).toLocal();
  } else {
    // æ²’æœ‰ 'Z' æ¨™è¨˜ï¼Œä½†å¯¦éš›ä¸Šæ˜¯ UTC æ™‚é–“
    // æ‰‹å‹•åŠ ä¸Š 'Z' å†è½‰æ›ç‚ºæœ¬åœ°æ™‚é–“
    timestamp = DateTime.parse('${timeString}Z').toLocal();
  }
  
  return ConsumptionRecord(
    timestamp: timestamp,
    // ...
  );
}
```

### è½‰æ›æµç¨‹

```
API å›å‚³:     "2025-10-28T08:09:14"
              â†“
åŠ ä¸Š 'Z':     "2025-10-28T08:09:14Z"
              â†“
è§£æç‚º UTC:   2025-10-28 08:09:14 UTC
              â†“
.toLocal():   2025-10-28 16:09:14 (UTC+8)
              â†“
é¡¯ç¤º:         2025-10-28 16:09:14 âœ…
```

## ğŸ¯ ç‚ºä»€éº¼ä¹‹å‰çš„åˆ¤æ–·éŒ¯èª¤

### èª¤åˆ¤åŸå› 
1. React ç‰ˆæœ¬ä½¿ç”¨ `new Date(record.eventTime)` æ²’æœ‰åšè½‰æ›
2. æˆ‘ä»¥ç‚º API å›å‚³çš„å·²ç¶“æ˜¯æœ¬åœ°æ™‚é–“
3. ä½†å¿½ç•¥äº† JavaScript çš„ `Date` æœƒè‡ªå‹•è™•ç†æ™‚å€

### JavaScript çš„è¡Œç‚º
```javascript
// JavaScript è‡ªå‹•è™•ç†æ™‚å€
new Date("2025-10-28T08:09:14")
// åœ¨ç€è¦½å™¨ä¸­ï¼Œé€™æœƒè¢«è§£æç‚ºæœ¬åœ°æ™‚å€çš„æ™‚é–“
// å¦‚æœæ²’æœ‰æ™‚å€æ¨™è¨˜ï¼Œæœƒè¢«ç•¶ä½œæœ¬åœ°æ™‚é–“
```

### Dart çš„è¡Œç‚º
```dart
// Dart ä¸æœƒè‡ªå‹•è™•ç†æ™‚å€
DateTime.parse("2025-10-28T08:09:14")
// é€™æœƒè¢«è§£æç‚º UTC æ™‚é–“ï¼Œä½†ä¸æœƒè‡ªå‹•è½‰æ›
// éœ€è¦æ‰‹å‹•å‘¼å« .toLocal()
```

## ğŸ“Š é©—è­‰æ–¹å¼

### æ¸¬è©¦æ¡ˆä¾‹
```
è¼¸å…¥: "2025-10-28T08:09:14"
é æœŸè¼¸å‡º: 2025-10-28 16:09:14 (UTC+8)

è¨ˆç®—æ–¹å¼:
08:09:14 (UTC) + 8 å°æ™‚ = 16:09:14 (UTC+8) âœ…
```

### æª¢æŸ¥ç†±é–€æ™‚æ®µ
æ¶ˆè²»æ™‚é–“æ˜¯ 16:09 (ä¸‹åˆ 4 é»)
- âœ… æ‡‰è©²æ­¸é¡åœ¨ 16:00-16:59 æ™‚æ®µ
- âœ… ä¸æ‡‰è©²å‡ºç¾åœ¨ 08:00-08:59 æ™‚æ®µ

## ğŸ”§ å®Œæ•´ä¿®æ­£å…§å®¹

### 1. `lib/models/consumption_record.dart`

```dart
factory ConsumptionRecord.fromJson(Map<String, dynamic> json) {
  final timeString = json['eventTime'] as String;
  DateTime timestamp;
  
  // è™•ç† UTC æ™‚é–“è½‰æœ¬åœ°æ™‚é–“
  if (timeString.endsWith('Z')) {
    timestamp = DateTime.parse(timeString).toLocal();
  } else {
    // API å›å‚³æ ¼å¼: "2025-10-28T08:09:14" (UTC ä½†ç„¡ Z æ¨™è¨˜)
    timestamp = DateTime.parse('${timeString}Z').toLocal();
  }
  
  final amount = (json['amount'] as num).toDouble();
  
  return ConsumptionRecord(
    timestamp: timestamp,
    userId: json['fid'].toString(),
    userName: json['targetUserName'] ?? '',
    beverageName: json['productName'] ?? 'Channel ${json['channel']}' ?? 'æœªçŸ¥å“é …',
    price: amount,
  );
}
```

### 2. `lib/widgets/results_display_widget.dart`

æ¢å¾©æ™‚å€æ¨™ç¤ºï¼š
```dart
Widget _buildRecordsList(List<ConsumptionRecord> records) {
  // è¨ˆç®—æ™‚å€åç§»
  final now = DateTime.now();
  final offsetHours = now.timeZoneOffset.inHours;
  final timeZoneStr = 'UTC${offsetHours >= 0 ? '+' : ''}$offsetHours';
  
  // é¡¯ç¤º: "æœ¬åœ°æ™‚é–“ (UTC+8)"
}
```

## âœ¨ æœ€çµ‚è¡Œç‚º

### æ¶ˆè²»è¨˜éŒ„é¡¯ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¶ˆè²»è¨˜éŒ„    ğŸ• æœ¬åœ°æ™‚é–“ (UTC+8)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ™‚é–“                å“å        åƒ¹æ ¼   â”‚
â”‚ 2025-10-28 16:09    å’–å•¡        NT$30  â”‚ âœ… æ­£ç¢ºï¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç†±é–€æ™‚æ®µåˆ†æ
```
ç†±é–€æ™‚æ®µ Top 3:
ğŸ¥‡ 16:00-16:59  (25æ¬¡)  âœ… ä¸‹åˆ 4 é»
ğŸ¥ˆ 09:00-09:59  (20æ¬¡)  âœ… æ—©ä¸Š 9 é»
ğŸ¥‰ 14:00-14:59  (15æ¬¡)  âœ… ä¸‹åˆ 2 é»
```

## ğŸ” Debug æŠ€å·§

### æª¢æŸ¥åŸå§‹æ™‚é–“
```dart
print('API æ™‚é–“: ${json['eventTime']}');
// è¼¸å‡º: 2025-10-28T08:09:14

print('åŠ  Z å¾Œ: ${json['eventTime']}Z');
// è¼¸å‡º: 2025-10-28T08:09:14Z

print('è§£æç‚º UTC: ${DateTime.parse('${json['eventTime']}Z')}');
// è¼¸å‡º: 2025-10-28 08:09:14.000Z

print('è½‰ç‚ºæœ¬åœ°: ${DateTime.parse('${json['eventTime']}Z').toLocal()}');
// è¼¸å‡º: 2025-10-28 16:09:14.000
```

### æª¢æŸ¥æ™‚å€åç§»
```dart
final now = DateTime.now();
print('ç•¶å‰æœ¬åœ°æ™‚é–“: $now');
print('ç•¶å‰ UTC æ™‚é–“: ${now.toUtc()}');
print('æ™‚å€åç§»: ${now.timeZoneOffset}');
// è¼¸å‡º: 8:00:00.000000
```

## ğŸ“‹ é‡è¦çµè«–

### API æ™‚é–“æ ¼å¼
- âœ… API å›å‚³çš„æ˜¯ **UTC æ™‚é–“**
- âœ… æ ¼å¼: `"2025-10-28T08:09:14"` (ç„¡ Z æ¨™è¨˜)
- âœ… éœ€è¦æ‰‹å‹•åŠ  'Z' ä¸¦è½‰æ›ç‚ºæœ¬åœ°æ™‚é–“

### è™•ç†æ–¹å¼
```dart
// âœ… æ­£ç¢º
DateTime.parse('${timeString}Z').toLocal()

// âŒ éŒ¯èª¤ (ç›´æ¥è§£æï¼Œä¸è½‰æ›)
DateTime.parse(timeString)
```

### è·¨èªè¨€å·®ç•°
- **JavaScript**: è‡ªå‹•è™•ç†æ™‚å€ï¼Œ`new Date()` æœƒæ ¹æ“šç³»çµ±æ™‚å€è§£æ
- **Dart**: ä¸è‡ªå‹•è™•ç†ï¼Œéœ€è¦æ˜ç¢ºå‘¼å« `.toLocal()`

## âœ… å®Œæˆç‹€æ…‹

âœ… **UTC æ™‚é–“æ­£ç¢ºè½‰æ›ç‚ºæœ¬åœ°æ™‚é–“**
âœ… **æ™‚å€æ¨™ç¤ºé¡¯ç¤º (UTC+8)**
âœ… **æ¶ˆè²»æ™‚é–“æ­£ç¢ºé¡¯ç¤º**
âœ… **ç†±é–€æ™‚æ®µæ­£ç¢ºåˆ†æ**
âœ… **Flutter Analyze: No issues found!**

## ğŸš€ æ¸¬è©¦æ–¹å¼

```bash
cd waferlock_bev_flutter
flutter run -d chrome
```

æŸ¥è©¢è³‡æ–™å¾Œï¼š
1. æª¢æŸ¥æ¶ˆè²»è¨˜éŒ„æ™‚é–“æ˜¯å¦æ­£ç¢ºï¼ˆ16:09 è€Œé 08:09ï¼‰
2. æª¢æŸ¥ç†±é–€æ™‚æ®µæ˜¯å¦åœ¨æ­£ç¢ºçš„æ™‚æ®µï¼ˆ16:00-16:59ï¼‰
3. ç¢ºèªæ™‚å€æ¨™ç¤ºé¡¯ç¤º "æœ¬åœ°æ™‚é–“ (UTC+8)"

ğŸ‰ æ™‚å€å•é¡Œå·²å¾¹åº•è§£æ±ºï¼
