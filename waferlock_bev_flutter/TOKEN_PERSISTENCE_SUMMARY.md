# ğŸ” Token æŒä¹…åŒ–èˆ‡è¼¸å…¥æ”¹å–„ç¸½çµ

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. Token æ°¸ä¹…å„²å­˜ (SharedPreferences)

#### ApiService æ”¹å–„
- âœ… æ–°å¢ `loadToken()` - æ‡‰ç”¨å•Ÿå‹•æ™‚è‡ªå‹•è¼‰å…¥å„²å­˜çš„ Token
- âœ… æ–°å¢ `_saveToken()` - ç™»å…¥æˆåŠŸå¾Œè‡ªå‹•å„²å­˜ Token
- âœ… æ–°å¢ `_clearToken()` - ç™»å‡ºæ™‚æ¸…é™¤ Token
- âœ… æ–°å¢ `saveCredentials()` - å„²å­˜ API æ†‘è­‰
- âœ… æ–°å¢ `loadCredentials()` - è¼‰å…¥å„²å­˜çš„æ†‘è­‰
- âœ… æ–°å¢ `clearCredentials()` - æ¸…é™¤æ†‘è­‰

#### å„²å­˜å…§å®¹
```dart
// Token å„²å­˜
SharedPreferences.setString('auth_token', token);

// æ†‘è­‰å„²å­˜ (JSON æ ¼å¼)
SharedPreferences.setString('cached_credentials', {
  "projectID": "WFLK_CTSP",
  "id": "your_id",
  "password": "your_password"
});
```

#### è‡ªå‹•è¼‰å…¥æµç¨‹
1. æ‡‰ç”¨å•Ÿå‹• â†’ `DataProvider.initialize()`
2. å‘¼å« `ApiService.loadToken()` è¼‰å…¥å„²å­˜çš„ Token
3. å‘¼å« `ApiService.loadCredentials()` è¼‰å…¥å„²å­˜çš„æ†‘è­‰
4. å¦‚æœæœ‰ Tokenï¼Œé¡¯ç¤ºã€Œå·²ä½¿ç”¨ç¾æœ‰ç™»å…¥æ¬Šæ–ã€
5. å¦‚æœæ²’æœ‰ Tokenï¼Œé¡¯ç¤ºç™»å…¥è¡¨å–®

### 2. è¼¸å…¥æ¬„ä½æ”¹å–„

#### æ”¯æ´è¤‡è£½è²¼ä¸Š
```dart
TextField(
  enableInteractiveSelection: true,  // âœ… å•Ÿç”¨é¸å–åŠŸèƒ½
  // å¯ä»¥ä½¿ç”¨ Ctrl+C / Cmd+C è¤‡è£½
  // å¯ä»¥ä½¿ç”¨ Ctrl+V / Cmd+V è²¼ä¸Š
  // å¯ä»¥ä½¿ç”¨æ»‘é¼ å³éµé¸å–®
)
```

#### é—œé–‰è‡ªå‹•æ ¡æ­£
```dart
TextField(
  autocorrect: false,         // âœ… é—œé–‰è‡ªå‹•æ ¡æ­£
  enableSuggestions: false,   // âœ… é—œé–‰è¼¸å…¥å»ºè­°
  // è¼¸å…¥çš„å…§å®¹ä¸æœƒè¢«è‡ªå‹•ä¿®æ”¹
)
```

#### æ”¹å–„çš„æ¬„ä½
- âœ… Project ID æ¬„ä½
- âœ… ID æ¬„ä½
- âœ… Password æ¬„ä½

#### ä½¿ç”¨è€…æç¤º
æ¯å€‹æ¬„ä½éƒ½æ–°å¢äº† `helperText: 'å¯è¤‡è£½è²¼ä¸Š'` æç¤ºä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨è¤‡è£½è²¼ä¸ŠåŠŸèƒ½ã€‚

### 3. Token ç”Ÿå‘½é€±æœŸç®¡ç†

#### ç™»å…¥æµç¨‹
```
ä½¿ç”¨è€…è¼¸å…¥æ†‘è­‰
    â†“
å‘¼å« API ç™»å…¥
    â†“
å–å¾— Token
    â†“
å„²å­˜ Token åˆ° SharedPreferences âœ…
    â†“
å„²å­˜æ†‘è­‰åˆ° SharedPreferences âœ…
    â†“
ä½¿ç”¨ Token å–å¾—è³‡æ–™
```

#### é‡å•Ÿæ‡‰ç”¨æµç¨‹
```
æ‡‰ç”¨å•Ÿå‹•
    â†“
DataProvider.initialize()
    â†“
å¾ SharedPreferences è¼‰å…¥ Token âœ…
    â†“
å¾ SharedPreferences è¼‰å…¥æ†‘è­‰ âœ…
    â†“
æª¢æŸ¥ Token æ˜¯å¦å­˜åœ¨
    â†“
å¦‚æœå­˜åœ¨ â†’ é¡¯ç¤ºã€Œå·²ä½¿ç”¨ç¾æœ‰ç™»å…¥æ¬Šæ–ã€
å¦‚æœä¸å­˜åœ¨ â†’ é¡¯ç¤ºç™»å…¥è¡¨å–®
```

#### ç™»å‡ºæµç¨‹
```
ä½¿ç”¨è€…é»æ“Šã€Œé‡æ–°ç™»å…¥ã€
    â†“
æ¸…é™¤ Token âœ…
    â†“
æ¸…é™¤æ†‘è­‰ âœ…
    â†“
æ¸…é™¤æ‰€æœ‰è³‡æ–™
    â†“
é¡¯ç¤ºç™»å…¥è¡¨å–®
```

#### Token éæœŸè™•ç†
```
API è«‹æ±‚å¤±æ•— (401/403)
    â†“
è‡ªå‹•æ¸…é™¤ Token âœ…
    â†“
è‡ªå‹•æ¸…é™¤æ†‘è­‰ âœ…
    â†“
é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
    â†“
é¡¯ç¤ºç™»å…¥è¡¨å–®
```

## ğŸ”’ å®‰å…¨æ€§è€ƒé‡

### å„²å­˜å®‰å…¨
- âš ï¸ SharedPreferences æ˜¯**æ˜æ–‡å„²å­˜**
- âš ï¸ å»ºè­°åƒ…å„²å­˜éæ•æ„Ÿçš„ Token
- âš ï¸ å¦‚éœ€æ›´é«˜å®‰å…¨æ€§ï¼Œå¯ä½¿ç”¨ `flutter_secure_storage`

### æ”¹å–„å»ºè­°
```dart
// æœªä¾†å¯ä»¥æ”¹ç”¨å®‰å…¨å„²å­˜
import 'package:flutter_secure_storage/flutter_secure_storage.dart';

final storage = FlutterSecureStorage();
await storage.write(key: 'auth_token', value: token);
String? token = await storage.read(key: 'auth_token');
```

## ğŸ“± ä½¿ç”¨é«”é©—æ”¹å–„

### ä¹‹å‰çš„å•é¡Œ
- âŒ æ¯æ¬¡é‡å•Ÿéƒ½è¦é‡æ–°ç™»å…¥
- âŒ ç„¡æ³•è¤‡è£½è²¼ä¸Šæ†‘è­‰
- âŒ è¼¸å…¥æ™‚æœƒè‡ªå‹•æ ¡æ­£
- âŒ Token ä¸æœƒå„²å­˜

### ç¾åœ¨çš„ç‹€æ…‹
- âœ… Token æ°¸ä¹…å„²å­˜ï¼Œé‡å•Ÿè‡ªå‹•è¼‰å…¥
- âœ… å¯ä»¥è¤‡è£½è²¼ä¸Šæ‰€æœ‰æ¬„ä½
- âœ… è¼¸å…¥å…§å®¹ä¸æœƒè¢«ä¿®æ”¹
- âœ… æ†‘è­‰ä¹Ÿæœƒå„²å­˜ï¼ˆå¯é¸ï¼‰

## ğŸ¯ å¯¦éš›ä½¿ç”¨æƒ…å¢ƒ

### æƒ…å¢ƒ 1: ç¬¬ä¸€æ¬¡ä½¿ç”¨
1. é–‹å•Ÿæ‡‰ç”¨
2. è¼¸å…¥ Project ID, ID, Password
3. é»æ“Šã€Œå–å¾—è³‡æ–™ã€
4. **Token è‡ªå‹•å„²å­˜** âœ…
5. ä¸‹æ¬¡é–‹å•Ÿæ‡‰ç”¨ï¼Œç›´æ¥ä½¿ç”¨å„²å­˜çš„ Token

### æƒ…å¢ƒ 2: è¤‡è£½è²¼ä¸Šæ†‘è­‰
1. å¾å…¶ä»–åœ°æ–¹è¤‡è£½ ID
2. åœ¨ ID æ¬„ä½æŒ‰å³éµ â†’ è²¼ä¸Š
3. æˆ–ä½¿ç”¨å¿«æ·éµ Cmd+V (Mac) / Ctrl+V (Windows)
4. **å…§å®¹ä¸æœƒè¢«è‡ªå‹•æ ¡æ­£** âœ…

### æƒ…å¢ƒ 3: é‡å•Ÿæ‡‰ç”¨
1. é—œé–‰æ‡‰ç”¨
2. å†æ¬¡é–‹å•Ÿ
3. **è‡ªå‹•è¼‰å…¥ Token** âœ…
4. é¡¯ç¤ºã€Œå·²ä½¿ç”¨ç¾æœ‰ç™»å…¥æ¬Šæ–ã€
5. ç›´æ¥æŸ¥è©¢è³‡æ–™ï¼Œç„¡éœ€é‡æ–°ç™»å…¥

### æƒ…å¢ƒ 4: åˆ‡æ›å¸³è™Ÿ
1. é»æ“Šã€Œé‡æ–°ç™»å…¥ã€æŒ‰éˆ•
2. **è‡ªå‹•æ¸…é™¤ Token å’Œæ†‘è­‰** âœ…
3. é¡¯ç¤ºç™»å…¥è¡¨å–®
4. è¼¸å…¥æ–°çš„æ†‘è­‰

### æƒ…å¢ƒ 5: Token éæœŸ
1. API å›å‚³ 401 éŒ¯èª¤
2. **è‡ªå‹•æ¸…é™¤éæœŸ Token** âœ…
3. é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
4. é¡¯ç¤ºç™»å…¥è¡¨å–®
5. é‡æ–°ç™»å…¥

## ğŸ§ª æ¸¬è©¦æ–¹æ³•

### æ¸¬è©¦ Token æŒä¹…åŒ–
```bash
# 1. å•Ÿå‹•æ‡‰ç”¨
flutter run -d chrome

# 2. ç™»å…¥ä¸¦å–å¾—è³‡æ–™
# 3. é—œé–‰æ‡‰ç”¨
# 4. å†æ¬¡å•Ÿå‹•
flutter run -d chrome

# 5. æ‡‰è©²çœ‹åˆ°ã€Œå·²ä½¿ç”¨ç¾æœ‰ç™»å…¥æ¬Šæ–ã€
```

### æ¸¬è©¦è¤‡è£½è²¼ä¸Š
```
1. è¤‡è£½ä¸€æ®µæ–‡å­—
2. åœ¨ ID æˆ– Password æ¬„ä½
3. å³éµé¸å–® â†’ è²¼ä¸Š
4. æˆ–ä½¿ç”¨ Cmd+V / Ctrl+V
5. æ–‡å­—æ‡‰è©²æ­£ç¢ºè²¼ä¸Š
```

### æ¸¬è©¦è‡ªå‹•æ ¡æ­£é—œé–‰
```
1. åœ¨ ID æ¬„ä½è¼¸å…¥ "test123"
2. æ‡‰è©²é¡¯ç¤ºç‚º "test123"
3. ä¸æœƒè®Šæˆ "Test123" æˆ–å…¶ä»–æ ¼å¼
```

### æª¢è¦–å„²å­˜çš„è³‡æ–™
```dart
// åœ¨é–‹ç™¼æ¨¡å¼ä¸‹ï¼Œå¯ä»¥æª¢è¦–å„²å­˜çš„è³‡æ–™
SharedPreferences prefs = await SharedPreferences.getInstance();
print('Token: ${prefs.getString('auth_token')}');
print('Credentials: ${prefs.getString('cached_credentials')}');
```

## ğŸ“‹ æ›´æ–°çš„æª”æ¡ˆ

### æ ¸å¿ƒæª”æ¡ˆ
1. âœ… `lib/services/api_service.dart` - Token å„²å­˜é‚è¼¯
2. âœ… `lib/providers/data_provider.dart` - åˆå§‹åŒ–è¼‰å…¥
3. âœ… `lib/widgets/file_upload_widget.dart` - è¼¸å…¥æ¬„ä½è¨­å®š
4. âœ… `lib/main.dart` - Provider åˆå§‹åŒ–

### ä½¿ç”¨çš„å¥—ä»¶
```yaml
dependencies:
  shared_preferences: ^2.2.2  # Token å„²å­˜
```

## âœ¨ å®Œæˆç‹€æ…‹

âœ… **Token æ°¸ä¹…å„²å­˜**
âœ… **è‡ªå‹•è¼‰å…¥ Token**
âœ… **è¤‡è£½è²¼ä¸ŠåŠŸèƒ½**
âœ… **é—œé–‰è‡ªå‹•æ ¡æ­£**
âœ… **Flutter Analyze: No issues found!**
âœ… **å®Œæ•´çš„éŒ¯èª¤è™•ç†**

ç¾åœ¨æ‚¨å¯ä»¥ï¼š
- ç™»å…¥ä¸€æ¬¡ï¼Œä¸‹æ¬¡è‡ªå‹•ä½¿ç”¨
- è¤‡è£½è²¼ä¸Šæ†‘è­‰è³‡è¨Š
- è¼¸å…¥å…§å®¹ä¸æœƒè¢«è‡ªå‹•ä¿®æ”¹
- Token åœ¨é‡å•Ÿå¾Œä¾ç„¶æœ‰æ•ˆ

ğŸ‰ æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆï¼
